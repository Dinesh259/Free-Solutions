<% 
    let backUrl = (user.role === 'admin') ? '/admin/dashboard' : '/student/dashboard';
%>

<%- include('partials/header', {title: 'Change Password', backLink: backUrl}) %>

<style>
    /* --- PAGE STYLES --- */
    .password-container {
        margin-top: 50px; 
        max-width: 500px;
        margin-left: auto; 
        margin-right: auto;
        padding: 0 15px;
    }

    .password-card {
        background: var(--bg-card, #ffffff);
        padding: 30px; 
        border-radius: 12px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        border: 1px solid var(--border-color, #ddd);
    }

    .form-label {
        display: block; 
        margin-bottom: 8px; 
        font-weight: 600; 
        color: var(--text-main, #333);
    }

    /* WRAPPER TO HOLD INPUT + ICON */
    .input-wrapper {
        position: relative;
        margin-bottom: 20px;
    }

    .form-input {
        width: 100%; 
        padding: 12px; 
        padding-right: 40px; /* Space for the eye icon */
        box-sizing: border-box; 
        border: 1px solid var(--border-color, #ccc); 
        border-radius: 8px;
        background-color: var(--bg-body, #fff);
        color: var(--text-main, #333);
        font-size: 16px;
    }

    .form-input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
    }

    /* THE EYE ICON STYLE */
    .toggle-password {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        cursor: pointer;
        color: var(--text-muted, #7f8c8d);
        font-size: 1.1rem;
        transition: color 0.2s;
    }

    .toggle-password:hover {
        color: #3498db;
    }

    .btn-update {
        width: 100%; 
        padding: 12px; 
        background: #2980b9; 
        color: white; 
        border: none; 
        border-radius: 8px; 
        font-size: 16px; 
        cursor: pointer;
        font-weight: bold;
        transition: background 0.2s;
    }
    .btn-update:hover {
        background: #3498db;
    }

    /* Alerts */
    .alert {
        padding: 12px; 
        border-radius: 8px; 
        margin-bottom: 20px; 
        text-align: center; 
        font-weight: 500;
        opacity: 1;
        transition: opacity 0.5s ease-out; 
    }
    .alert-error {
        background: rgba(231, 76, 60, 0.15);
        color: #e74c3c;
        border: 1px solid #e74c3c;
    }
    .alert-success {
        background: rgba(46, 204, 113, 0.15);
        color: #27ae60;
        border: 1px solid #27ae60;
    }
</style>

<div class="password-container">
    
    <div class="password-card">
        <h3 style="margin-top: 0; margin-bottom: 25px; text-align: center; color: var(--text-main);">
            ðŸ”’ Change Password
        </h3>

        <% if (error) { %>
            <div class="alert alert-error"><%= error %></div>
        <% } %>
        
        <% if (success) { %>
            <div class="alert alert-success"><%= success %></div>
        <% } %>

        <form action="/change-password" method="POST">
            
            <label class="form-label">Current Password</label>
            <div class="input-wrapper">
                <input type="password" name="oldPassword" id="oldPass" placeholder="Enter current password" required class="form-input">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('oldPass', this)"></i>
            </div>
            
            <label class="form-label">New Password</label>
            <div class="input-wrapper">
                <input type="password" name="newPassword" id="newPass" placeholder="Enter new password" required minlength="6" class="form-input">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('newPass', this)"></i>
            </div>
            
            <label class="form-label">Confirm New Password</label>
            <div class="input-wrapper">
                <input type="password" name="confirmPassword" id="confirmPass" placeholder="Re-enter new password" required class="form-input">
                <i class="fas fa-eye toggle-password" onclick="togglePassword('confirmPass', this)"></i>
            </div>

            <button type="submit" class="btn-update">Update Password</button>
        </form>
    </div>

    <div style="height: 50px;"></div>
</div>

<script>
    // --- 1. TOGGLE PASSWORD VISIBILITY ---
    function togglePassword(inputId, icon) {
        const input = document.getElementById(inputId);
        
        if (input.type === "password") {
            input.type = "text";           // Show password
            icon.classList.remove("fa-eye");
            icon.classList.add("fa-eye-slash"); // Change icon to 'crossed out eye'
        } else {
            input.type = "password";       // Hide password
            icon.classList.remove("fa-eye-slash");
            icon.classList.add("fa-eye");       // Change icon back to normal eye
        }
    }

    // --- 2. AUTO HIDE ALERTS ---
    document.addEventListener("DOMContentLoaded", function() {
        const alerts = document.querySelectorAll('.alert');
        if (alerts.length > 0) {
            setTimeout(function() {
                alerts.forEach(function(alert) {
                    alert.style.opacity = '0'; 
                    setTimeout(() => alert.style.display = 'none', 500); 
                });
            }, 3000); 
        }
    });
</script>