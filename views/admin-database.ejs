<%- include('partials/header', { title: 'Full Database', backLink: '/admin/dashboard' }) %>

<div class="container" style="max-width: 98%; margin-top: 30px; margin-bottom: 50px;">
    
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2>üìÇ Database Management</h2>
        <a href="/admin/dashboard" style="background: #27ae60; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px; font-weight: bold;">
            ‚ûï Upload New
        </a>
    </div>

    <% 
        // Filter the data into two separate lists
        const mathData = questions.filter(q => q.subject === 'Mathematics');
        const scienceData = questions.filter(q => q.subject === 'Science');
    %>

    <h3 style="background: #3498db; color: white; padding: 10px; border-radius: 5px 5px 0 0; margin-bottom: 0;">
        üìê Mathematics (<%= mathData.length %>)
    </h3>
    
    <div style="overflow-x: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 40px;">
        <table border="1" style="width: 100%; border-collapse: collapse; background: white; font-size: 14px;">
            <thead>
                <tr style="background: #ecf0f1; color: #2c3e50; text-align: left;">
                    <th style="padding: 10px;">Class</th>
                    <th style="padding: 10px;">Medium</th>
                    <th style="padding: 10px;">Chapter</th>
                    <th style="padding: 10px;">Ex.</th>
                    <th style="padding: 10px;">Q.No</th>
                    <th style="padding: 10px;">Description</th>
                    <th style="padding: 10px;">Image</th> <th style="padding: 10px;">Video ID</th>
                    <th style="padding: 10px;">Actions</th> 
                </tr>
            </thead>
            <tbody>
                <% if(mathData.length > 0) { %>
                    <% mathData.forEach(q => { %>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px;"><%= q.classLevel %></td>
                            <td style="padding: 10px;"><%= q.medium %></td>
                            <td style="padding: 10px;"><%= q.chapterName %></td>
                            <td style="padding: 10px;"><%= q.exercise %></td> 
                            <td style="padding: 10px; font-weight: bold;"><%= q.questionNumber %></td>
                            
                            <td style="padding: 10px;">
                                <%= q.questionDescription ? (q.questionDescription.substring(0, 15) + '...') : '-' %>
                            </td>

                            <td style="padding: 10px; text-align: center;">
                                <% if(q.questionImage) { %>
                                    <img src="<%= q.questionImage %>" alt="Q-Img" 
                                         onclick="openModal('<%= q.questionImage %>')"
                                         style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; transition: transform 0.2s;"
                                         onmouseover="this.style.transform='scale(1.1)'"
                                         onmouseout="this.style.transform='scale(1)'">
                                <% } else { %>
                                    <span style="color: #bdc3c7; font-size: 20px;">-</span>
                                <% } %>
                            </td>

                            <td style="padding: 10px; font-family: monospace; color: #e67e22;"><%= q.videoID %></td>
                            
                            <td style="padding: 10px; min-width: 140px;">
                                <a href="/admin/edit/<%= q._id %>" style="background: #f39c12; color: white; padding: 5px 8px; text-decoration: none; border-radius: 4px; font-size: 12px; margin-right: 5px;">
                                    ‚úèÔ∏è Edit
                                </a>
                                <a href="/admin/delete/<%= q._id %>" onclick="return confirm('Are you sure you want to delete this?');" style="background: #e74c3c; color: white; padding: 5px 8px; text-decoration: none; border-radius: 4px; font-size: 12px;">
                                    üóëÔ∏è Del
                                </a>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr><td colspan="9" style="text-align: center; padding: 15px;">No Math solutions found.</td></tr>
                <% } %>
            </tbody>
        </table>
    </div>

    <h3 style="background: #e67e22; color: white; padding: 10px; border-radius: 5px 5px 0 0; margin-bottom: 0;">
        üî¨ Science (<%= scienceData.length %>)
    </h3>

    <div style="overflow-x: auto; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
        <table border="1" style="width: 100%; border-collapse: collapse; background: white; font-size: 14px;">
            <thead>
                <tr style="background: #ecf0f1; color: #2c3e50; text-align: left;">
                    <th style="padding: 10px;">Class</th>
                    <th style="padding: 10px;">Medium</th>
                    <th style="padding: 10px;">Chapter</th>
                    <th style="padding: 10px;">Q.No</th>
                    <th style="padding: 10px;">Description</th>
                    <th style="padding: 10px;">Image</th> <th style="padding: 10px;">Video ID</th>
                    <th style="padding: 10px;">Actions</th> 
                </tr>
            </thead>
            <tbody>
                <% if(scienceData.length > 0) { %>
                    <% scienceData.forEach(q => { %>
                        <tr style="border-bottom: 1px solid #ddd;">
                            <td style="padding: 10px;"><%= q.classLevel %></td>
                            <td style="padding: 10px;"><%= q.medium %></td>
                            <td style="padding: 10px;"><%= q.chapterName %></td>
                            <td style="padding: 10px; font-weight: bold;"><%= q.questionNumber %></td>
                            
                            <td style="padding: 10px;">
                                <%= q.questionDescription ? (q.questionDescription.substring(0, 15) + '...') : '-' %>
                            </td>

                            <td style="padding: 10px; text-align: center;">
                                <% if(q.questionImage) { %>
                                    <img src="<%= q.questionImage %>" alt="Q-Img" 
                                         onclick="openModal('<%= q.questionImage %>')"
                                         style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px; border: 1px solid #ddd; cursor: pointer; transition: transform 0.2s;"
                                         onmouseover="this.style.transform='scale(1.1)'"
                                         onmouseout="this.style.transform='scale(1)'">
                                <% } else { %>
                                    <span style="color: #bdc3c7; font-size: 20px;">-</span>
                                <% } %>
                            </td>

                            <td style="padding: 10px; font-family: monospace; color: #e67e22;"><%= q.videoID %></td>
                            
                            <td style="padding: 10px; min-width: 140px;">
                                <a href="/admin/edit/<%= q._id %>" style="background: #f39c12; color: white; padding: 5px 8px; text-decoration: none; border-radius: 4px; font-size: 12px; margin-right: 5px;">
                                    ‚úèÔ∏è Edit
                                </a>
                                <a href="/admin/delete/<%= q._id %>" onclick="return confirm('Are you sure you want to delete this?');" style="background: #e74c3c; color: white; padding: 5px 8px; text-decoration: none; border-radius: 4px; font-size: 12px;">
                                    üóëÔ∏è Del
                                </a>
                            </td>
                        </tr>
                    <% }) %>
                <% } else { %>
                    <tr><td colspan="8" style="text-align: center; padding: 15px;">No Science solutions found.</td></tr>
                <% } %>
            </tbody>
        </table>
    </div>

</div>

<div id="imgModal" onclick="closeModal()" style="display: none; position: fixed; z-index: 9999; padding-top: 50px; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.85);">
    
    <span style="position: absolute; top: 20px; right: 35px; color: #fff; font-size: 40px; font-weight: bold; cursor: pointer;">&times;</span>
    
    <img id="modalImage" style="margin: auto; display: block; width: 80%; max-width: 800px; max-height: 80vh; object-fit: contain; border-radius: 8px; box-shadow: 0 0 20px rgba(255,255,255,0.2);">
    
</div>

<script>
    function openModal(imageSrc) {
        const modal = document.getElementById("imgModal");
        const modalImg = document.getElementById("modalImage");
        modal.style.display = "block"; 
        modalImg.src = imageSrc;       
        document.body.style.overflow = "hidden"; 
    }

    function closeModal() {
        document.getElementById("imgModal").style.display = "none";
        document.body.style.overflow = "auto"; 
    }
</script>

</body>
</html>